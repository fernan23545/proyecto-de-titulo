{% extends "base.html" %}

{% block content %}
<div class="max-w-xl mx-auto">
  <a href="{% url 'ver_carrito' %}" class="text-sm text-green-700 hover:underline">
    ← Volver al carrito
  </a>

  <h1 class="text-2xl font-bold mt-4 mb-2">
    Agendar servicio: {{ producto.nombre }}
  </h1>

  <p class="text-sm text-gray-600 mb-4">
    Emprendimiento: {{ emprendimiento.nombre }}
  </p>

  <div class="bg-white rounded-2xl border shadow p-6">
    
    <!-- FORMULARIO PRINCIPAL -->
    <form method="post" class="space-y-4">
      {% csrf_token %}

      <div class="grid md:grid-cols-2 gap-4">

        <div>
          <label class="block text-sm font-medium">Nombre</label>
          {{ form.nombre_cliente }}
        </div>

        <div>
          <label class="block text-sm font-medium">Teléfono</label>
          {{ form.telefono }}
        </div>

        <div>
          <label class="block text-sm font-medium">Correo</label>
          {{ form.email }}
        </div>

        {% if form.servicio %}
        <div>
          <label class="block text-sm font-medium">Servicio</label>
          {{ form.servicio }}
        </div>
        {% endif %}

        <!-- FECHA CON BLOQUEO DE FIN DE SEMANA -->
        <div>
          <label class="block text-sm font-medium">Fecha</label>
          <input 
              type="date" 
              id="fecha" 
              name="fecha" 
              value="{{ request.GET.fecha }}" 
              class="border p-2 rounded w-full"
              required>
        </div>

        <!-- SELECT DINÁMICO DE HORARIOS -->
        <div>
          <label class="block text-sm font-medium">Hora disponible</label>

          {% if horarios_disponibles %}
            <select name="hora" class="border p-2 rounded w-full" required>
              {% for h in horarios_disponibles %}
                <option value="{{ h }}">{{ h }}</option>
              {% endfor %}
            </select>
          {% else %}
            <p class="text-xs text-gray-500">
              Selecciona una fecha para ver horarios disponibles.
            </p>
          {% endif %}
        </div>

      </div>

      <!-- COMENTARIO -->
      <div>
        <label class="block text-sm font-medium">Comentario</label>
        {{ form.comentario }}
      </div>

      <button class="w-full mt-3 px-4 py-2 rounded bg-green-600 text-white font-semibold hover:bg-green-700">
        Confirmar reserva
      </button>

    </form>

  </div>
</div>

<!-- SCRIPT PARA BLOQUEAR SABADOS Y DOMINGOS Y RECARGAR HORAS -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    const fechaInput = document.getElementById("fecha");

    // Bloquear sábados y domingos
    fechaInput.addEventListener("input", function () {
        const fecha = new Date(this.value);

        if (fecha.getDay() === 6 || fecha.getDay() === 0) {
            alert("No se pueden seleccionar sábados ni domingos.");
            this.value = "";
            return;
        }

        // Recargar página con la fecha seleccionada para mostrar horas disponibles
        if (this.value !== "") {
            const url = new URL(window.location.href);
            url.searchParams.set("fecha", this.value);
            window.location.href = url.toString();
        }
    });
});
</script>

{% endblock %}
